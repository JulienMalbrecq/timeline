<html>
	<head></head>
	<body>
		<script>

            var TimeSlice = function (startDate, endDate) {
                this.startDate = startDate;
                this.endDate = endDate;
            };


			var OverlapResolver = function () {};
			OverlapResolver.prototype = {
				getOverlapScore: function (firstSlice, secondSlice) {
					var isWithinRange = function (refSlice, searchDate) {
						return searchDate >= refSlice.startDate && searchDate <= refSlice.endDate;
					},
					score = 0;
					
					if (isWithinRange(secondSlice, firstSlice.startDate)) {
						score |= OverlapResolver.flag.REF_START;
					}
					
					if (isWithinRange(secondSlice, firstSlice.endDate)) {
						score |= OverlapResolver.flag.REF_END;
					}
					
					if (isWithinRange(firstSlice, secondSlice.startDate)) {
						score |= OverlapResolver.flag.NEW_START;
					}
					
					if (isWithinRange(firstSlice, secondSlice.endDate)) {
						score |= OverlapResolver.flag.NEW_END;
					}
					
					return score;
				}
			};
			
			OverlapResolver.flag = {
				REF_START: 1,
				REF_END: 2,
				NEW_START: 4,
				NEW_END: 8
			};
			
			OverlapResolver.mask = {
				DELETE: TimeSlice.overlapFlags.REF_START | TimeSlice.overlapFlags.REF_END,
				MOVE_START: TimeSlice.overlapFlags.REF_START | TimeSlice.overlapFlags.NEW_END,
				MOVE_END: TimeSlice.overlapFlags.REF_END | TimeSlice.overlapFlags.NEW_START,
				INSERT: TimeSlice.overlapFlags.NEW_START | TimeSlice.overlapFlags.NEW_END
			};
			
			function compare(score, mask) {
				return (score & mask) === mask;
			}
			
			var oldSlice = new TimeSlice(4, 8),
				testSlices = {
					'delete_exact': new TimeSlice(4, 8), 
					'delete_englobe': new TimeSlice(3, 9),
					'delete_start': new TimeSlice(3, 8), 
					'delete_end': new TimeSlice(4, 9),
					'no_overlap': new TimeSlice(2, 3),
					'move_start': new TimeSlice(3, 6),
					'move_end': new TimeSlice(5, 9),
					'insert': new TimeSlice(5, 6),
				};
			
			function launchTest() {
				var all = function (operation) {
					var i, score;
					
					for (i in testSlices) {
						if (testSlices.hasOwnProperty(i)) {
							score = oldSlice.getOverlapScore(testSlices[i]);
							console.log(i, compare(score, operation));
						}
					}
				};
				
				for (var o in OverlapResolver.mask) {
					if (OverlapResolver.mask.hasOwnProperty(o)) {
						console.log(o);
						console.log('----');
						all(OverlapResolver.mask[o]);
					}
					console.log('----');
				}
			}
		</script>
	</body>
</html>
