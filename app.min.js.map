{"version":3,"sources":["../src-es6/timeline/TimeLineApp.es6"],"names":["_classCallCheck","instance","Constructor","TypeError","value","DateUtils","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","refDate","Date","resourceServer","ConfigValues","TimeLineApp","./lib/utils/Date.es6","2","require","module","exports","EventCallback","callback","weight","this","setEnabled","setWeight","createTool","self","arguments","undefined","moveTool","enabled","tmp","constructor","call","apply","playandgold","timeSlices","itGroup","mousedown","parseInt","renderer","addSlice","line","arg","Array","isArray","CustomEvent","sameProjectOverlapping","timeSlice","overlapping","callbacks","eventCallback","push","createButtons","toolBox","attachButton","index","b","moveButtons"],"mappings":";;qdAEA,SAAAA,GAAAC,EAAAC,GAAA,KAAAD,YAAAC,IAAA,KAAA,IAAAC,WAAA,2EAFAC,OAAA,MAAYC,aACZ,IAAAC,GAAA,WAAA,QAAAC,GAAAC,EAAAC,GAAA,IAAA,GAAAC,GAAA,EAAAA,EAAAD,EAAAE,OAAAD,IAAA,CAAA,GAAAE,GAAAH,EAAAC,EAAAE,GAAAC,WAAAD,EAAAC,aAAA,EAAAD,EAAAE,cAAA,EAAA,SAAAF,KAAAA,EAAAG,UAAA,GAAAC,OAAAC,eAAAT,EAAAI,EAAAM,IAAAN,IAAA,MAAA,UAAAV,EAAAiB,EAAAC,GAAA,MAAAD,IAAAZ,EAAAL,EAAAmB,UAAAF,GAAAC,GAAAb,EAAAL,EAAAkB,GAAAlB,qFAEAoB,QAAA,GAAAC,4CACAC,eAAA,yBACA,QAAAC,2GAEAnB,GAAAmB,yIAGMC,OAAAA,oDAGEC,uBAAeL,IAAfM,GAAA,SAAAC,EAAAC,EAAAC,oJAIA3B,OAAA,0QAQA,QAAA4B,GAAAC,EAAAC,aAGHC,KAAAC,iCAEDD,KAAAE,UAAAH,GAoCII,+CAlCA,GAAIC,KAAOC,UAAX7B,OAAA,OAAA8B,KAAAD,UAAA,KAAAA,UAAA,EAAAL,MAEIO,QAAWC,KAFfzB,IAAA,cAAAd,MAAA,SAAA6B,GAAA,KAMOW,GANPX,EAAAY,aAAAZ,EAAAa,MAAAb,EAAAc,OAOIC,KAAAA,0CAPJb,MAUIc,SAAAA,KAGJC,IAAAA,6BAEAZ,GAAAA,GAAWa,UAAYxC,OAAA,OAAsB8B,KAAtBD,UAAsB,GAAAA,UAAA,GAAA,CAErCL,MAAAD,OAAAkB,SAAAlB,EAAA,OAGJhB,IAAA,OACA0B,MAAAA,WACAL,GAAAA,GAAKc,UAASC,OAAcC,OAA5Bd,KAAAD,UAAA,GAAAA,UAAA,GAAAL,KAPJqB,EAAAhB,UAAA,EAUAF,IAAAA,KAAAA,cAIKkB,GAAAC,MAAAC,QAAAF,GAAAA,GAAAA,gCAKLlB,KACwCqB,EAApC,WAAA,QAAAA,GACIC,GAA4C5D,EAAAmC,KAAa0B,eAE7D1B,KAAAQ,SAAImB,EACA3B,KAAA4B,aACID,KAAAA,mBAGQlB,GAAAA,IACAA,IAAAA,aACHxC,MAAA,WACJ,GAAAuC,KANDH,UAAA7B,OAAA,OAAA8B,KAAAD,UAAA,KAAAA,UAAA,EAQAD,MAAAA,QAAAA,KAGJA,IAAAA,cACAK,MAAAA,SAAAX,GACH,GAAA+B,GAAM,GAAAhC,GAAAC,EAEHM,OADAU,MAAAA,UAAAA,KAAWgB,GACX1B,0BAKRnC,MAAA,SAAgB8D,GACZ3B,GAAAA,GAAK4B,KAAQC,UAAAA,UAAaF,SAA1BjC,GACH,MAAAA,KAAA+B,GAEDK,IAAYC,GACR/B,KAAK4B,UAAQC,OAAAA,EAAaG","file":"app.min.js","sourcesContent":["import * as DateUtils from '../lib/utils/Date';\nimport EventsManager from '../lib/EventsManager';\nimport OverlapResolver from './OverlapResolver';\nimport TimeLine from './TimeLine';\nimport TimeLineRenderer from './TimeLineRenderer';\nimport TimeLineToolbox from './TimeLineToolbox';\nimport ProjectFactory from './data/Project';\nimport TimeSliceFactory from './data/TimeSlice';\nimport MouseStateListener from '../lib/MouseStateListener';\n\nclass TimeLineApp {\n    constructor (wrapper, refDate) {\n        this.wrapper = wrapper;\n        this.refDate = refDate;\n\n        this.eventManager = new EventsManager({private: true});\n\n        this.overlapResolver = new OverlapResolver(this.eventManager);\n        this.timeLine = new TimeLine(wrapper, refDate);\n        this.renderer = new TimeLineRenderer(wrapper, refDate);\n\n        TimeSliceFactory.eventsManager = this.eventManager;\n\n        this.toolBox = new TimeLineToolbox(this.timeLine, new MouseStateListener(document.querySelector('html')));\n\n        // add a data manager which will manage the loading and rendering of the timelines\n\n        this.init();\n    }\n\n    // temp\n    init() {\n        let self = this,\n            itGroup = this.timeLine.addGroup('it'),\n            moveTool = this.toolBox.createTool('move'),\n            createTool = this.toolBox.getToolByName('create'),\n            createButtons = document.querySelectorAll('[data-tool=create]'),\n            moveButtons = document.querySelectorAll('[data-tool=move]'),\n            b, tmp,\n            playandgold = ProjectFactory.create('Play&Gold', '#FC0'),\n            antargaz = ProjectFactory.create('Antargaz', '#0F0'),\n            currentProject = playandgold,\n            timeSlices = [];\n\n        itGroup.addLine('Julien');\n        itGroup.addLine('Brieuc');\n\n        createTool.mousedown = function (line, tile) {\n            if (line === undefined) {\n                return;\n            }\n\n            var date = self.timeLine.getDateFromTile(tile);\n            tmp = TimeSliceFactory.create(currentProject, line.user, date, date);\n            self.renderer.addSlice(tmp, line);\n        };\n\n        createTool.mousemove = function (line, tile) {\n            var date = self.timeLine.getDateFromTile(tile);\n            if (date >= tmp.startDate) {\n                tmp.endDate = date;\n            }\n\n            self.renderer.refresh();\n        };\n\n        createTool.mouseup = function (line, tile) {\n            var overlapping = timeSlices.filter(timeSlice => timeSlice.user === tmp.user && OverlapResolver.isOverlapping(timeSlice, tmp)),\n                sameProjectOverlapping = overlapping.filter(timeSlice => timeSlice.project === tmp.project);\n\n            if (overlapping.length > 0) {\n                if (overlapping.length === sameProjectOverlapping.length) {\n                    overlapping.forEach(refSlice => {\n                        if (tmp.project === refSlice.project) {\n                            self.overlapResolver.resolve(refSlice, tmp);\n                            tmp.startDate = refSlice.startDate;\n                            tmp.endDate = refSlice.endDate;\n                        }\n                    });\n\n                    self.renderer.refresh();\n                }\n\n                self.renderer.removeSlice(tmp);\n                tmp = null;\n            } else {\n                timeSlices.push(tmp);\n                self.renderer.refresh();\n            }\n\n        };\n\n        for (b = 0; b < createButtons.length; b += 1) {\n            self.toolBox.attachButton(createButtons[b], createTool);\n        }\n\n        for (b = 0; b < moveButtons.length; b += 1) {\n            self.toolBox.attachButton(moveButtons[b], moveTool);\n        }\n    }\n}\n\nlet timeline = new TimeLineApp(document.getElementById('timeline'), DateUtils.toMidnight(new Date()));"]}