// 2017-11-16

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0}),c.Config=void 0;var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./lib/utils/Date.es6"),g={mainWrapper:document.getElementById("timeline"),refDate:new Date,startHour:8,tilesPerDay:8,tileSize:19,resourceServer:"timeline"},h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,a),Object.assign(this,b)}return e(a,[{key:"startDate",get:function(){return this.refDate},set:function(a){this.refDate=(0,f.toMidnight)(a)}}]),a}();window.TimeLineConfig&&Object.assign(g,window.TimeLineConfig);c.Config=new h(g)},{"./lib/utils/Date.es6":6}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.setEnabled(),this.setCallback(b),this.setWeight(c)}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"setCallback",value:function(a){if(!(a&&a.constructor&&a.call&&a.apply))throw"The callback argument is not a function.";this.callback=a}},{key:"setWeight",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.weight=parseInt(a,10)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];if(this.enabled)return b=Array.isArray(b)?b:[b],this.callback.apply(a,b)}}]),a}(),g=function(){function a(b){d(this,a),this.name=b,this.enabled=!0,this.callbacks=[],this.setEnabled()}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"addCallback",value:function(a){var b=new f(a);return this.callbacks.push(b),b}},{key:"removeCallback",value:function(a){var b=this.callbacks.findIndex(function(b){return b===a});b>-1&&this.callbacks.splice(b,1)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];this.callbacks.sort(function(a,b){return a.weight<=b.weight?1:-1}),this.callbacks.forEach(function(c){return c.fire(a,b)})}}]),a}(),h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(d(this,a),this.private=!1,this.events={},Object.assign(this,b),!1===this.private)return void 0===a.instance&&(a.instance=this),a.instance}return e(a,[{key:"bind",value:function(a,b){var c=this;if(Array.isArray(a)){var d={};return a.forEach(function(a){return d[a]=c.bind(a,b)}),d}return!1===this.hasEvent(a)&&(this.events[a]=new g(a)),this.events[a].addCallback(b)}},{key:"detachEvent",value:function(a){var b=this.events[a];return this.removeEvent(a),b}},{key:"hasEvent",value:function(a){return void 0!==this.events[a]}},{key:"getEvent",value:function(a){if(!1===this.hasEvent(a))throw"Unknown event "+a;return this.events[a]}},{key:"fireEvent",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;if(a instanceof g==!1){if(!this.hasEvent(a))return this;a=this.getEvent(a)}a instanceof g&&a.fire(c,b)}},{key:"fireEventAsync",value:function(a,b,c){var d=this;setTimeout(function(){return d.fireEvent(a,b,c)},1)}},{key:"fireEventOnce",value:function(a,b,c){this.fireEvent(this.detachEvent(a),b,c)}},{key:"fireEventOnceAsync",value:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;setTimeout(function(){return c.fireEventOnce(a,b,d)},1)}},{key:"disableEvent",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getEvent(a).enabled=b}},{key:"removeEvent",value:function(a){delete this.events[a]}}]),a}();c.default=h},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=this;d(this,a),this._isDown=!1,this.wrapper=b,b.addEventListener("mousedown",function(a){return c._isDown=!0}),b.addEventListener("mouseup",function(a){return c._isDown=!1})}return e(a,[{key:"isDown",get:function(){return this._isDown}}]),a}();c.default=f},{}],4:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=function(a,b,c){Array.isArray(a)||(a=[a]);var d=void 0,f=a.length;for(d=0;d<f;d+=1)e(a[d],b,c)},e=c.manipulateClassNames=function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=(a.className||"").trim().split(" ").filter(function(a){return a!==b});c&&d.push(b),a.className=d.join(" ").trim()},f=(c.addClass=function(a,b){d(a,b,!0)},c.removeClass=function(a,b){d(a,b,!1)},c.toggleClass=function(a,b){d(a,b,f(a,b))},c.hasClass=function(a,b){return(a.className||"").trim().split(" ").filter(function(a){return a===b}).length>0})},{}],5:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.isDark=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,c=a.substring(1),d=parseInt(c,16);return.2126*(d>>16&255)+.7152*(d>>8&255)+.0722*(d>>0&255)<=b}},{}],6:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=(c.INTERVAL={ONEMINUTE:6e4,ONEHOUR:36e5,ONEDAY:864e5},c.dateDiff=function(a,b,c){return Math.floor((a-b)/c)},c.setHour=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return a.setHours(b),a.setMinutes(c),a.setSeconds(d),a.setMilliseconds(e),a});c.toMidnight=function(a){return d(a,0)}},{}],7:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getTileLengthFromDuration=c.getDateFromTile=c.getDaysFromTile=c.getTileFromDate=c.getTileFromOffset=void 0;var d=a("./Date.es6"),e=a("../../Config.es6"),f=(c.getTileFromOffset=function(a){return Math.floor(a/e.Config.tileSize)},c.getTileFromDate=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Config.startDate,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Config.startHour,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Config.tilesPerDay,g=(0,d.setHour)(new Date(a),c);return(0,d.dateDiff)(a,b,d.INTERVAL.ONEDAY)*f+(0,d.dateDiff)(a,g,d.INTERVAL.ONEHOUR)},c.getDaysFromTile=function(a){return Math.floor(a/e.Config.tilesPerDay)});c.getDateFromTile=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Config.startDate;return new Date(b.getTime()+d.INTERVAL.ONEDAY*f(a)+d.INTERVAL.ONEHOUR*(e.Config.startHour+a%e.Config.tilesPerDay))},c.getTileLengthFromDuration=function(a){return Math.ceil(a/d.INTERVAL.ONEHOUR)}},{"../../Config.es6":1,"./Date.es6":6}],8:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){return b>=a.startDate&&b<=a.endDate}function g(a,b){var c=0;return f(b,a.startDate)&&(c|=o.REF_START),f(b,a.endDate)&&(c|=o.REF_END),f(a,b.startDate)&&(c|=o.NEW_START),f(a,b.endDate)&&(c|=o.NEW_END),c}function h(a,b){return(a&b)===b}function i(a,b){var c=g(a,b),d=[a,b];return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate=b.startDate,d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate=b.endDate,d.push(q.RESOLUTION_OVERLAP_END)):h(c,p.SURROUND)?(a.startDate=b.startDate,a.endDate=b.endDate,d.push(q.RESOLUTION_SURROUND)):d=null,d}function j(a,b){var c=g(a,b),d=[a,b],e=void 0;return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_END)):(e=n.factory.create(a.project,a.startDate,a.endDate),e.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_SURROUND),d.push(e)),e}Object.defineProperty(c,"__esModule",{value:!0}),c.event=c.resolutionType=void 0;var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a("../lib/utils/Date.es6"),m=a("./data/entity/TimeSlice.es6"),n=d(m),o={REF_START:1,REF_END:2,NEW_START:4,NEW_END:8},p={SURROUND:o.REF_START|o.REF_END,OVERLAP_START:o.REF_START|o.NEW_END,OVERLAP_END:o.REF_END|o.NEW_START,WITHIN:o.NEW_START|o.NEW_END},q=c.resolutionType={RESOLUTION_WITHIN:0,RESOLUTION_OVERLAP_START:1,RESOLUTION_OVERLAP_END:2,RESOLUTION_SURROUND:3},r=c.event={RESOLVED_OVERLAP:"overlap-resolver-resolved-overlap",RESOLVED_MERGE:"overlap-resolver-resolved-overlap"},s=function(){function a(b){e(this,a),this.eventManager=b}return k(a,[{key:"isOverlapping",value:function(a,b){return g(a,b)>0}},{key:"isAdjacent",value:function(a,b){var c={startDate:new Date(b.startDate.getTime()-l.INTERVAL.ONEHOUR),endDate:new Date(b.endDate.getTime()+l.INTERVAL.ONEHOUR)};return this.isOverlapping(a,c)}},{key:"resolve",value:function(a,b){var c=void 0,d=void 0,e=null;return this.isOverlapping(a,b)?(c=a.project===b.project?r.RESOLVED_MERGE:r.RESOLVED_OVERLAP,d=a.project===b.project?i(a,b):j(a,b),e={type:c,resolution:d}):a.project===b.project&&this.isAdjacent(a,b)&&(a.startDate<b.startDate?(console.log("extending end"),b.startDate=new Date(b.startDate.getTime()-l.INTERVAL.ONEHOUR)):(console.log("extending start"),b.endDate=new Date(b.endDate.getTime()+l.INTERVAL.ONEHOUR)),e={type:r.RESOLVED_MERGE,resolution:i(a,b)}),e}}]),a}();c.default=s},{"../lib/utils/Date.es6":6,"./data/entity/TimeSlice.es6":23}],9:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=function(b){b.line=a};return k.addClass(c,"label"),c.appendChild(document.createTextNode(a.user.name)),k.addClass(b,"user-timeline"),b.appendChild(c),d.addEventListener("mousedown",e),d.addEventListener("mousemove",e),d.addEventListener("mouseup",e),d.setAttribute("data-timeline",a.user.name),k.addClass(d,"time"),b.appendChild(d),b}Object.defineProperty(c,"__esModule",{value:!0}),c.events=c.Line=void 0;var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/Tile.es6"),i=d(h),j=a("../lib/utils/CSS.es6"),k=d(j),l=c.Line=function a(b,c){e(this,a),this.startDate=b,this.user=c},m=c.events={LINE_ADDED:"timeline-line-added",SLICE_ADDED:"timeline-slice-added",SLICE_REMOVED:"timeline-slice-removed"},n=function(){function a(b,c,d){e(this,a),this.eventsManager=d,this.wrapper=b,this.startDate=c,this.slices=[]}return g(a,[{key:"addGroup",value:function(b){var c=document.createDocumentFragment(),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=new a(e,this.startDate,this.eventsManager);return d.setAttribute("class","group-wrapper"),f.setAttribute("class","group-wrapper-title"),e.setAttribute("class","line-wrapper"),f.appendChild(document.createTextNode(b)),d.appendChild(f),d.appendChild(e),c.appendChild(d),this.wrapper.appendChild(c),g}},{key:"addLine",value:function(a){var b=new l(this.startDate,a),c=f(b);b.wrapper=c,this.wrapper.appendChild(c),a.timeLine=b,this.eventsManager.fireEvent(m.LINE_ADDED,b)}},{key:"addSlice",value:function(a){void 0===this.slices.find(function(b){return b===a})&&(this.eventsManager.fireEvent(m.SLICE_ADDED,a),this.slices.push(a))}},{key:"removeSlice",value:function(a){var b=this.slices.findIndex(function(b){return b===a});b>=0&&(this.slices.splice(b,1),this.eventsManager.fireEvent(m.SLICE_REMOVED,a))}},{key:"getLineSlices",value:function(a){return this.slices.filter(function(b){return b.line===a})}},{key:"getSlice",value:function(a,b){var c=i.getDateFromTile(b);return this.slices.find(function(b){return b.line===a&&b.containsDate(c)})}}]),a}();c.default=n},{"../lib/utils/CSS.es6":4,"../lib/utils/Tile.es6":7}],10:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./TimeLineContainer.es6"),i=e(h),j=a("./data/AbstractDataFactory.es6"),k=d(j),l=a("./data/TimeLineDataManager.es6"),m=a("./OverlapResolver.es6"),n=a("./TimeLine.es6"),o=d(n),p=a("./data/entity/TimeSlice.es6"),q=a("./widget/TimeLineHeaderWidget.es6"),r=e(q),s=a("./widget/UserLabelWidget.es6"),t=e(s),u=a("../Config.es6"),v=a("./widget/TimeLineStyleWidget.es6"),w=e(v),x=function(){function a(){f(this,a),this.container=new i.default,this.eventManager=this.container.get("eventsManager"),this.overlapResolver=this.container.get("overlapResolver"),this.timeLine=this.container.get("timeLine"),this.renderer=this.container.get("renderer"),this.toolBox=this.container.get("toolbox"),this.projects=[],this.init(),this.initInterface()}return g(a,[{key:"initInterface",value:function(){new r.default(u.Config.startDate,u.Config.tileSize,u.Config.tilesPerDay,u.Config.daysToShow||14).initInterface(),new w.default(u.Config.startDate,u.Config.tileSize,u.Config.tilesPerDay).initInterface(),new t.default(this.eventManager)}},{key:"init",value:function(){var a=this,b=this.container.get("dataManager").getDataManager("project").findAll(),c=this.container.get("dataManager").getDataManager("user").findAll();Promise.all([b,c]).then(function(b){var c=a.container.get("entityBank");c.addBank("projects",b[0]),c.addBank("users",b[1]),a.toolBox.initInterface(),a.initTimeLine(c.getBank("users"))}),this.eventManager.bind(o.events.SLICE_ADDED,function(b){a.renderer.initSlice(b)}),this.eventManager.bind(o.events.SLICE_REMOVED,function(a){void 0!==a.element&&(a.element=null)}),this.eventManager.bind(k.events.POST_CREATE,function(b){b&&b instanceof p.TimeSlice&&a.timeLine.addSlice(b)}),this.eventManager.bind(k.events.CHANGED,function(b){b&&b instanceof p.TimeSlice&&b.changed&&a.renderer.render(a.timeLine.slices)}),this.eventManager.bind(l.events.POST_REMOVE,function(b){b&&b instanceof p.TimeSlice&&a.timeLine.removeSlice(b)}),this.eventManager.bind([l.events.PRE_PERSIST,l.events.PRE_UPDATE],function(b){b.resource instanceof p.TimeSlice&&a.handleNewTimeSliceEvent(b)})}},{key:"initTimeLine",value:function(a){var b=this,c=[];a.forEach(function(a){var b=c.find(function(b){return b.name===a.group});b||(b={name:a.group,users:[]},c.push(b)),b.users.push(a)}),c.forEach(function(a){var c=b.timeLine.addGroup(a.name);a.users.forEach(function(a){return c.addLine(a)})})}},{key:"handleNewTimeSliceEvent",value:function(a){var b=this,c=a.resource,d=(c.line,void 0),e=[],f=this.container.get("dataManager").getDataManager("timeslice"),g=this.timeLine.slices.filter(function(a){return a!==c&&a.line===c.line&&b.overlapResolver.isOverlapping(a,c)}),h=g.filter(function(a){return c.project===a.project});g.length>0&&(g.length===h.length?g.forEach(function(g){if(null!==(d=b.overlapResolver.resolve(g,c))){if(b.timeLine.removeSlice(c),e.push(g),!1===c.isTemp){var h=e.findIndex(function(a){return a===c});h>=0&&e.splice(h,1),f.remove(c)}d.type!==m.resolutionType.RESOLUTION_WITHIN&&(c=g,a.canceled=!0)}}):a.canceled=!0),e.forEach(function(a){return f.update(a)}),this.renderer.render(this.timeLine.slices)}}]),a}();new x},{"../Config.es6":1,"./OverlapResolver.es6":8,"./TimeLine.es6":9,"./TimeLineContainer.es6":11,"./data/AbstractDataFactory.es6":15,"./data/TimeLineDataManager.es6":18,"./data/entity/TimeSlice.es6":23,"./widget/TimeLineHeaderWidget.es6":30,"./widget/TimeLineStyleWidget.es6":31,"./widget/UserLabelWidget.es6":32}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../lib/EventsManager.es6"),h=d(g),i=a("./OverlapResolver.es6"),j=d(i),k=a("./TimeLine.es6"),l=d(k),m=a("./TimeLineRenderer.es6"),n=d(m),o=a("../lib/MouseStateListener.es6"),p=d(o),q=a("./data/TimeLineDataManager.es6"),r=d(q),s=a("./data/dataManager/ProjectDataManager.es6"),t=d(s),u=a("./data/dataManager/TimeSliceDataManager.es6"),v=d(u),w=a("./data/entity/TimeSlice.es6"),x=a("./TimeLineToolbox.es6"),y=d(x),z=a("./tool/CreateTool.es6"),A=d(z),B=a("./tool/MoveTool.es6"),C=d(B),D=a("./tool/DeleteTool.es6"),E=d(D),F=a("./data/entity/Project.es6"),G=d(F),H=a("./data/entity/User.es6"),I=d(H),J=a("./data/dataManager/UserDataManager.es6"),K=d(J),L=a("../Config.es6"),M=a("./TimeLineEntityBank.es6"),N=d(M),O=function(){function a(){e(this,a),this._services={},this.init()}return f(a,[{key:"init",value:function(){var a=this;this._services.eventsManager=new h.default({private:!0}),this._services.entityBank=new N.default,this._services.mouseListener=new p.default(document.querySelector("html")),this._services.timeSliceFactory=new w.TimeSliceFactory(this._services.entityBank,this._services.eventsManager),this._services.projectFactory=new G.default(this._services.eventsManager),this._services.userFactory=new I.default(this._services.eventsManager),this._services.dataManager=new r.default,[{manager:t.default,factory:this._services.projectFactory},{manager:v.default,factory:this._services.timeSliceFactory},{manager:K.default,factory:this._services.userFactory}].forEach(function(b){return a._services.dataManager.addDataManager(new b.manager(a._services.eventsManager,b.factory))}),this._services.overlapResolver=new j.default(this._services.eventsManager),this._services.timeLine=new l.default(L.Config.mainWrapper,L.Config.startDate,this._services.eventsManager),this._services.renderer=new n.default(L.Config.mainWrapper,L.Config.startDate),this._services.toolbox=new y.default(this._services.timeLine,this._services.mouseListener),this._services.tools={create:new A.default(this._services.timeLine,this._services.timeSliceFactory,this._services.entityBank,this._services.dataManager.getDataManager("timeslice")),delete:new E.default(this._services.timeLine,this._services.dataManager.getDataManager("timeslice")),move:new C.default(this._services.timeLine,this._services.dataManager.getDataManager("timeslice"))},Object.keys(this._services.tools).forEach(function(b){return a._services.toolbox.addTool(a._services.tools[b])})}},{key:"get",value:function(a){if(!1==a in this._services)throw"Undefined service "+a;return this._services[a]}}]),a}();c.default=O},{"../Config.es6":1,"../lib/EventsManager.es6":2,"../lib/MouseStateListener.es6":3,"./OverlapResolver.es6":8,"./TimeLine.es6":9,"./TimeLineEntityBank.es6":12,"./TimeLineRenderer.es6":13,"./TimeLineToolbox.es6":14,"./data/TimeLineDataManager.es6":18,"./data/dataManager/ProjectDataManager.es6":19,"./data/dataManager/TimeSliceDataManager.es6":20,"./data/dataManager/UserDataManager.es6":21,"./data/entity/Project.es6":22,"./data/entity/TimeSlice.es6":23,"./data/entity/User.es6":24,"./tool/CreateTool.es6":25,"./tool/DeleteTool.es6":26,"./tool/MoveTool.es6":27}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./data/ManagedEntity.es6"),h=d(g),i=function(){function a(){e(this,a),this._banks={}}return f(a,[{key:"addBank",value:function(a,b){if(!Array.isArray(b)||b.find(function(a){return!1==a instanceof h.default}))throw Error("Data must be an array of ManagedEntity");this._banks[a]=b}},{key:"getBank",value:function(a){return this.hasBank(a)?this._banks[a]:null}},{key:"getFromBank",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=this._banks[a];return null!==d?d.find(function(a){return a.id===b}):c}},{key:"hasBank",value:function(a){return void 0!==this._banks[a]}}]),a}();c.default=i},{"./data/ManagedEntity.es6":17}],13:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../lib/utils/Tile.es6"),h=a("../lib/utils/Color.es6"),i=d(h),j=a("../Config.es6"),k=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,a),this.wrapper=b,this.refDate=c}return f(a,[{key:"render",value:function(a){a.forEach(function(a){if(!1!==a.changed){var b=(0,g.getTileFromDate)(a.startDate),c=void 0,d=void 0,e=void 0;b<0&&(b=0),c=(0,g.getTileFromDate)(a.endDate)+1,d=c-b,e={width:d*j.Config.tileSize+"px",left:b*j.Config.tileSize+"px",backgroundColor:""+a.project.color},Object.assign(a.element.style,e),a.changed=!1}})}},{key:"initSlice",value:function(a){var b=document.createElement("div"),c=["time-slice"];i.isDark(a.project.color,130)&&c.push("dark-background"),b.appendChild(document.createTextNode(a.project.name)),b.setAttribute("class",c.join(" ")),b.setAttribute("title",a.project.name),a.element=b}}]),a}();c.default=k},{"../Config.es6":1,"../lib/utils/Color.es6":5,"../lib/utils/Tile.es6":7}],14:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/CSS.es6"),i=d(h),j=a("../lib/utils/Tile.es6"),k=d(j),l=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(this,a),this.timeLine=b,this.mouseListener=c,this.tools=[],this.attachedButtons=[],this.initListeners()}return g(a,[{key:"initListeners",value:function(){var a=this;this.timeLine&&this.mouseListener&&(this._toolDependencies={timeLine:this.timeLine,mouseListener:this.mouseListener},this.timeLine.wrapper.addEventListener("mousedown",function(b){void 0!==b.line&&a.handleMouseEvent("mouseDown",b.line,b.offsetX)}),this.timeLine.wrapper.addEventListener("mousemove",function(b){a.mouseListener.isDown&&void 0!==b.line&&a.handleMouseEvent("mouseMove",b.line,b.offsetX)}),this.mouseListener.wrapper.addEventListener("mouseup",function(b){a.handleMouseEvent("mouseUp",b.line||null,b.offsetX)}),this.tools.forEach(function(b){return Object.assign(b,a._toolDependencies)}))}},{key:"initInterface",value:function(){var a=this;this.tools.forEach(function(b){[].concat(e(document.querySelectorAll('[data-tool="'+b.name+'"]'))).forEach(function(c){return a.attachButton(c,b)}),b.initInterface()})}},{key:"addTool",value:function(a){Object.assign(a,this._toolDependencies),this.tools.push(a)}},{key:"getToolByName",value:function(a){return this.tools.find(function(b){return b.name===a})}},{key:"attachButton",value:function(a,b){var c=this;a.addEventListener("click",function(a){a.preventDefault(),c.tools.forEach(function(a){return a.active=a===b}),c.redraw()}),this.attachedButtons.push({button:a,tool:b})}},{key:"handleMouseEvent",value:function(a,b,c){var d=k.getTileFromOffset(c),e=this.tools.find(function(a){return a.active});e&&e[a]&&e[a](b,d)}},{key:"redraw",value:function(){this.attachedButtons.forEach(function(a){var b=a.tool.active?"addClass":"removeClass";i[b](a.button,"active")})}}]),a}();c.default=l},{"../lib/utils/CSS.es6":4,"../lib/utils/Tile.es6":7}],15:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=(c.AbstractDataFactory=function(){function a(b){d(this,a),this.eventsManager=b}return e(a,[{key:"create",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];this.eventsManager.fireEvent(f.PRE_CREATE,b);var d=this.createEntity.apply(this,b);return this.eventsManager.fireEvent(f.POST_CREATE,d),d}},{key:"createEntity",value:function(){throw"You should define a createEntity method in class "+this.constructor.name}}]),a}(),c.events={CHANGED:"data-changed",PRE_CREATE:"data-pre-create-event",POST_CREATE:"data-post-create-event"})},{}],16:[function(a,b,c){(function(b){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./TimeLineDataManager.es6"),h="undefined"!=typeof window?window.fermata:void 0!==b?b.fermata:null,i=d(h),j=a("../../Config.es6"),k=i.default.json(j.Config.resourceServer),l=function(){function a(b,c,d){e(this,a),this.resourceName=b,this.resourceServer=k[b],this.eventsManager=c,this.factory=d}return f(a,[{key:"findAll",value:function(){return this.findBy()}},{key:"find",value:function(a){return this.findBy({id:a})}},{key:"findBy",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){a.resourceServer(b).get(function(b,e){b?d(b):c(a.parseData(e))})})}},{key:"update",value:function(a){var b={resource:a,canceled:!1};return this.eventsManager.fireEvent(g.events.PRE_UPDATE,b),!1===b.canceled?(console.log("updating",a),this.eventsManager.fireEvent(g.events.POST_UPDATE,a)):console.log("should not update",a),!b.canceled}},{key:"persist",value:function(a){if(a.id)return this.update(a);var b={resource:a,canceled:!1};return this.eventsManager.fireEvent(g.events.PRE_PERSIST,b),!1===b.canceled?(a.isTemp=!1,console.log("persisting",a),a.id=1,this.eventsManager.fireEvent(g.events.POST_PERSIST,a)):console.log("should not persist",a),!b.canceled}},{key:"remove",value:function(a){this.eventsManager.fireEvent(g.events.PRE_REMOVE,a),console.log("removing",a),this.eventsManager.fireEvent(g.events.POST_REMOVE,a)}},{key:"parseData",value:function(a){throw"You should define a parseData method in class "+this.constructor.name}}]),a}();c.default=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../Config.es6":1,"./TimeLineDataManager.es6":18}],17:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;d(this,a),this._id=b}return e(a,[{key:"id",get:function(){return this._id},set:function(a){this._id=a}}]),a}();c.default=f},{}],18:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this.dataManagers=[]}return e(a,[{key:"addDataManager",value:function(a){this.dataManagers.push(a)}},{key:"getDataManager",value:function(a){return this.dataManagers.find(function(b){return b.resourceName===a})}}]),a}();c.default=f;c.events={PRE_PERSIST:"data-manager-pre-persist",POST_PERSIST:"data-manager-post-persist",PRE_REMOVE:"data-manager-pre-remove",POST_REMOVE:"data-manager-post-remove",PRE_UPDATE:"data-manager-pre-update",POST_UPDATE:"data-manager-post-update"}},{}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../AbstractDataManager.es6"),j=d(i),k=function(a){function b(a,c){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"project",a,c))}return g(b,a),h(b,[{key:"parseData",value:function(a){var b=this;return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return b.factory.create(a.name,a.color)})}}]),b}(j.default);c.default=k},{"../AbstractDataManager.es6":16}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../AbstractDataManager.es6"),j=d(i),k=a("../entity/TimeSlice.es6"),l=function(a){function b(a,c){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"timeslice",a,c))}return g(b,a),h(b,[{key:"parseData",value:function(a){return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return k.factory.create(a.project,null,a.startDate,a.endDate,!1,!1)})}}]),b}(j.default);c.default=l},{"../AbstractDataManager.es6":16,"../entity/TimeSlice.es6":23}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../AbstractDataManager.es6"),j=d(i),k=function(a){function b(a,c){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"user",a,c))}return g(b,a),h(b,[{key:"update",value:function(a){}},{key:"persist",value:function(a){}},{key:"remove",value:function(a){}},{key:"parseData",value:function(a){var b=this;return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return b.factory.createEntity(a)})}}]),b}(j.default);c.default=k},{"../AbstractDataManager.es6":16}],22:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0}),c.Project=void 0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../ManagedEntity.es6"),j=d(i),k=a("../AbstractDataFactory.es6"),l=c.Project=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.name=a,d.color=c,d}return g(b,a),b}(j.default),m=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"createEntity",value:function(a,b){return new l(a,b)}}]),b}(k.AbstractDataFactory);c.default=m},{"../AbstractDataFactory.es6":15,"../ManagedEntity.es6":17}],23:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0}),c.TimeSliceFactory=c.TimeSlice=void 0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../ManagedEntity.es6"),j=d(i),k=a("../AbstractDataFactory.es6"),l=a("./Project.es6"),m=a("../../TimeLine.es6"),n=c.TimeSlice=function(a){function b(a,c,d,g){var h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e(this,b);var j=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return j._project=a,j._line=c,j._startDate=d,j._endDate=g,j._isTemp=h,j._changed=i,j._element=null,j.eventsManager=null,j}return g(b,a),h(b,[{key:"containsDate",value:function(a){return this._startDate<=a&&this._endDate>=a}},{key:"duration",get:function(){return this._endDate-this._startDate}},{key:"element",get:function(){return this._element},set:function(a){null!==a?this._line.wrapper.querySelector(".time").appendChild(a):this._element&&this._element.parentNode.removeChild(this._element),this._element=a}},{key:"project",get:function(){return this._project},set:function(a){this._project=a,this.changed=!0}},{key:"line",get:function(){return this._line},set:function(a){this._line=a,this.changed=!0}},{key:"startDate",get:function(){return this._startDate},set:function(a){this._startDate=a,this.changed=!0}},{key:"endDate",get:function(){return this._endDate},set:function(a){this._endDate=a,this.changed=!0}},{key:"isTemp",get:function(){return this._isTemp},set:function(a){this._isTemp=a,this.changed=!0}},{key:"changed",get:function(){return this._changed},set:function(a){this._changed=a,this.eventsManager&&this.eventsManager.fireEvent(k.events.CHANGED,this)}}]),b}(j.default);c.TimeSliceFactory=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.entityBank=a,d}return g(b,a),h(b,[{key:"createEntity",value:function(a,b,c,d){!1==a instanceof l.Project&&(a=this.entityBank.getFromBank("projects",a)),!1==b instanceof m.Line&&(console.log(b),b=this.entityBank.getFromBank("users",b).timeLine),c=new Date(c),d=new Date(d);for(var e=arguments.length,f=Array(e>4?e-4:0),g=4;g<e;g++)f[g-4]=arguments[g];var h=new(Function.prototype.bind.apply(n,[null].concat([a,b,c,d],f)));return h.eventsManager=this.eventsManager,h}}]),b}(k.AbstractDataFactory)},{"../../TimeLine.es6":9,"../AbstractDataFactory.es6":15,"../ManagedEntity.es6":17,"./Project.es6":22}],24:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0}),c.User=void 0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../ManagedEntity.es6"),j=d(i),k=a("../AbstractDataFactory.es6"),l=c.User=function(a){function b(a,c,d){e(this,b);var g=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return g.name=c,g.group=d,g}return g(b,a),b}(j.default),m=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"createEntity",value:function(a){var b=a.id,c=a.name,d=a.group;return new l(b,c,d)}}]),b}(k.AbstractDataFactory);c.default=m},{"../AbstractDataFactory.es6":15,"../ManagedEntity.es6":17}],25:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=a("./TimeLineTool.es6"),l=e(k),m=a("../../lib/utils/Tile.es6"),n=d(m),o=function(a){function b(a,c,d,e){g(this,b);var f=h(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"create",a));return f.timeSliceManager=e,f.timeSliceFactory=c,f.entityBank=d,f.lastSlice=null,f._currentProject=null,f.projectList=[],f}return i(b,a),j(b,[{key:"initInterface",value:function(){var a=this,b=document.querySelectorAll('[data-tool-create="selector"]'),c=document.createDocumentFragment();this.projectList=this.entityBank.getBank("projects"),this.projectList.length>0&&(this.currentProject=this.projectList[0].name),this.projectList.forEach(function(a){var b=document.createElement("option"),d=document.createTextNode(a.name);b.appendChild(d),b.setAttribute("value",a.name),c.appendChild(b)}),[].concat(f(b)).forEach(function(b){b.appendChild(c),b.addEventListener("change",function(b){return a.currentProject=b.target.value})})}},{key:"mouseDown",value:function(a,b){if(null!==a){console.log(a);var c=n.getDateFromTile(b);this.lastSlice=this.timeSliceFactory.create(this.currentProject,a,c,c)}}},{key:"mouseMove",value:function(a,b){var c=n.getDateFromTile(b);this.lastSlice&&c>=this.lastSlice.startDate&&(this.lastSlice.endDate=c)}},{key:"mouseUp",value:function(a,b){a&&!1===this.timeSliceManager.persist(this.lastSlice)&&this.timeLine.removeSlice(this.lastSlice),this.lastSlice=null}},{key:"currentProject",get:function(){return this._currentProject},set:function(a){this._currentProject=this.projectList.find(function(b){return b.name===a})}}]),b}(l.default);c.default=o},{"../../lib/utils/Tile.es6":7,"./TimeLineTool.es6":28}],26:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./TimeLineTool.es6"),j=d(i),k=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"delete",a));return d.timeSliceManager=c,d.selectedSlice=null,d}return g(b,a),h(b,[{key:"mouseDown",value:function(a,b){this.selectedSlice=this.timeLine.getSlice(a,b)}},{key:"mouseUp",value:function(a,b){if(this.selectedSlice){var c=this.timeLine.getSlice(a,b);this.selectedSlice===c&&this.timeSliceManager.remove(this.selectedSlice)}this.selectedSlice=null}}]),b}(j.default);c.default=k},{"./TimeLineTool.es6":28}],27:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./TimeLineTool.es6"),j=d(i),k=a("../../lib/utils/Tile.es6"),l=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"move",a));return d.timeSliceManager=c,d.origin=null,d.selectedSlice=null,d}return g(b,a),h(b,[{key:"mouseDown",value:function(a,b){this.selectedSlice=this.timeLine.getSlice(a,b),this.selectedSlice&&(this.origin={line:a,tile:b,startTile:(0,k.getTileFromDate)(this.selectedSlice.startDate),endTile:(0,k.getTileFromDate)(this.selectedSlice.endDate)})}},{key:"mouseMove",value:function(a,b){this.selectedSlice&&this.computeNewPosition(b)}},{key:"mouseUp",value:function(a,b){if(this.selectedSlice){!1===this.timeSliceManager.update(this.selectedSlice)&&this.computeNewPosition(this.origin.tile)}this.origin=null,this.selectedSlice=null}},{key:"computeNewPosition",value:function(a){var b=a-this.origin.tile,c=this.origin.endTile+b,d=this.origin.startTile+b;this.origin.tile===this.origin.startTile?d>=0&&d<=this.origin.endTile&&(this.selectedSlice.startDate=(0,k.getDateFromTile)(d)):this.origin.tile===this.origin.endTile?c>=this.origin.startTile&&(this.selectedSlice.endDate=(0,k.getDateFromTile)(c)):d>=0&&(this.selectedSlice.startDate=(0,k.getDateFromTile)(d),this.selectedSlice.endDate=(0,k.getDateFromTile)(c))}}]),b}(j.default);c.default=l},{"../../lib/utils/Tile.es6":7,"./TimeLineTool.es6":28}],28:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d(this,a),this.name=b,this.active=!1,this.timeLine=c,this.mouseListener=e}return e(a,[{key:"initInterface",value:function(){}},{key:"mouseDown",value:function(a,b){}},{key:"mouseMove",value:function(a,b){}},{key:"mouseUp",value:function(a,b){}}]),a}();c.default=f},{}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,[{key:"initInterface",value:function(){}}]),a}();c.default=f},{}],30:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../../lib/utils/Date.es6"),i=a("../../lib/utils/CSS.es6"),j=d(i),k=function(){function a(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14;f(this,a),this.refDate=b,this.tileWidth=c,this.tilePerDay=d,this._daysToShow=e,this.wrapper=null}return g(a,[{key:"initInterface",value:function(){if(this.wrapper=document.querySelector('[data-widget="timeline-headers"] .time'),this.wrapper){[].concat(e(this.wrapper.childNodes)).forEach(function(a){return a.parentNode.removeChild(a)});var a=document.createDocumentFragment(),b=new Date((0,h.toMidnight)(this.refDate)),c=void 0;for(c=0;c<this._daysToShow;c+=1)a.appendChild(this.createDayHeader(b)),b=new Date(b.getTime()+h.INTERVAL.ONEDAY);this.wrapper.appendChild(a)}}},{key:"createDayHeader",value:function(a){var b=document.createElement("div"),c=document.createTextNode(a.toLocaleDateString("fr-FR"));return b.appendChild(c),b.style.width=this.dayWidth+"px",j.addClass(b,"day"),(0,h.toMidnight)(a).getTime()===(0,h.toMidnight)(new Date).getTime()&&j.addClass(b,"today"),0!==a.getDay()&&6!==a.getDay()||j.addClass(b,"weekend"),b}},{key:"daysToShow",set:function(a){this._daysToShow=a}},{key:"dayWidth",get:function(){return this.tilePerDay*this.tileWidth}}]),a}();c.default=k},{"../../lib/utils/CSS.es6":4,"../../lib/utils/Date.es6":6}],31:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#CCCCCC",g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#EEEEEE";d(this,a),this.refDate=b,this.tileSize=c,this.tilePerDay=e,this.strokeColor=f,this.fillColor=g}return e(a,[{key:"initInterface",value:function(){var a=document.createElement("style"),b=this.createGridImage();a.innerHTML="[data-timeline] { background: url("+b+"); height: "+this.tileSize+"px; }",document.querySelector("head").appendChild(a)}},{key:"createGridImage",value:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=7*this.tilePerDay,d=void 0,e=void 0,f=6+this.refDate.getDay()%7,g=f*this.tilePerDay;for(a.setAttribute("width",c*this.tileSize),a.setAttribute("height",this.tileSize),b.fillStyle=this.fillColor,d=0;d<c;g+=1,d+=1)b.beginPath(),b.strokeStyle=d%this.tilePerDay==0?"#666666":this.strokeColor,e=this.tileSize*d+.5,(g>>3)%7>4&&b.fillRect(e,0,this.tileSize,this.tileSize),b.moveTo(e,0),b.lineTo(e,this.tileSize),b.stroke();return a.toDataURL()}}]),a}();c.default=f},{}],32:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../TimeLine.es6"),h=function(){function a(b){e(this,a),this.eventsManager=b,this.init()}return f(a,[{key:"init",value:function(){this.eventsManager.bind(g.events.LINE_ADDED,this.computeEqualWidth)}},{key:"computeEqualWidth",value:function(){var a=[].concat(d(document.querySelectorAll(".user-timeline .label")));a&&(a.forEach(function(a){return delete a.style.width}),a.sort(function(a,b){return a.clientWidth>=b.clientWidth?-1:1}),a.map(function(b){return b.style.width=a[0].clientWidth+"px"}))}}]),a}();c.default=h},{"../TimeLine.es6":9}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]);
//# sourceMappingURL=app.min.js.map