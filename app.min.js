2017-07-07
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.setEnabled(),this.setCallback(b),this.setWeight(c)}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"setCallback",value:function(a){if(!(a&&a.constructor&&a.call&&a.apply))throw"The callback argument is not a function.";this.callback=a}},{key:"setWeight",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.weight=parseInt(a,10)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];if(this.enabled)return b=Array.isArray(b)?b:[b],this.callback.apply(a,b)}}]),a}(),g=function(){function a(b){d(this,a),this.name=b,this.enabled=!0,this.callbacks=[],this.setEnabled()}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"addCallback",value:function(a){var b=new f(a);return this.callbacks.push(b),b}},{key:"removeCallback",value:function(a){var b=this.callbacks.findIndex(function(b){return b===a});b>-1&&this.callbacks.splice(b,1)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];this.callbacks.sort(function(a,b){return a.weight<=b.weight?1:-1}),this.callbacks.forEach(function(c){return c.fire(a,b)})}}]),a}(),h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(d(this,a),this.private=!1,this.events={},Object.assign(this,b),!1===this.private)return void 0===a.instance&&(a.instance=this),a.instance}return e(a,[{key:"bind",value:function(a,b){return!1===this.hasEvent(a)&&(this.events[a]=new g(a)),this.events[a].addCallback(b)}},{key:"detachEvent",value:function(a){var b=this.events[a];return this.removeEvent(a),b}},{key:"hasEvent",value:function(a){return void 0!==this.events[a]}},{key:"getEvent",value:function(a){if(!1===this.hasEvent(a))throw"Unknown event "+a;return this.events[a]}},{key:"fireEvent",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;if(a instanceof g==!1){if(!this.hasEvent(a))return this;a=this.getEvent(a)}a instanceof g&&a.fire(c,b)}},{key:"fireEventAsync",value:function(a,b,c){var d=this;setTimeout(function(){return d.fireEvent(a,b,c)},1)}},{key:"fireEventOnce",value:function(a,b,c){this.fireEvent(this.detachEvent(a),b,c)}},{key:"fireEventOnceAsync",value:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;setTimeout(function(){return c.fireEventOnce(a,b,d)},1)}},{key:"disableEvent",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getEvent(a).enabled=b}},{key:"removeEvent",value:function(a){delete this.events[a]}}]),a}();c.default=h},{}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=this;d(this,a),this._isDown=!1,b.addEventListener("mousedown",function(){return c._isDown=!0}),b.addEventListener("mouseup",function(){return c._isDown=!1})}return e(a,[{key:"isDown",get:function(){return this._isDown}}]),a}();c.default=f},{}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=function(a,b,c){Array.isArray(a)||(a=[a]);var d=void 0,f=a.length;for(d=0;d<f;d+=1)e(a[d],b,c)},e=c.manipulateClassNames=function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=(a.className||"").trim().split(" ").filter(function(a){return a!==b});c&&d.push(b),a.className=d.join(" ").trim()},f=(c.addClass=function(a,b){d(a,b,!0)},c.removeClass=function(a,b){d(a,b,!1)},c.toggleClass=function(a,b){d(a,b,f(a,b))},c.hasClass=function(a,b){return(a.className||"").trim().split(" ").filter(function(a){return a===b}).length>0})},{}],4:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=c.INTERVAL={ONEMINUTE:6e4,ONEHOUR:36e5,ONEDAY:864e5},e=c.dateDiff=function(a,b,c){return Math.floor((a-b)/c)},f=c.setHour=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return a.setHours(b),a.setMinutes(c),a.setSeconds(d),a.setMilliseconds(e),a};c.toMidnight=function(a){return f(a,0)},c.tileFromDate=function(a,b,c,g){var h=f(new Date(a),c);return e(a,b,d.ONEDAY)*g+e(a,h,d.ONEHOUR)}},{}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){return b>=a.startDate&&b<=a.endDate}function g(a,b){var c=0;return f(b,a.startDate)&&(c|=o.REF_START),f(b,a.endDate)&&(c|=o.REF_END),f(a,b.startDate)&&(c|=o.NEW_START),f(a,b.endDate)&&(c|=o.NEW_END),c}function h(a,b){return(a&b)===b}function i(a,b){var c=g(a,b),d=[a,b];return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate=b.startDate,d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate=b.endDate,d.push(q.RESOLUTION_OVERLAP_END)):h(c,p.SURROUND)?(a.startDate=b.startDate,a.endDate=b.endDate,d.push(q.RESOLUTION_SURROUND)):d=null,d}function j(a,b){var c=g(a,b),d=[a,b],e=void 0;return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_END)):(e=n.default.create(a.project,a.startDate,a.endDate),e.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_SURROUND),d.push(e)),e}Object.defineProperty(c,"__esModule",{value:!0}),c.event=c.resolutionType=void 0;var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a("../lib/utils/Date"),m=a("./data/TimeSlice"),n=d(m),o={REF_START:1,REF_END:2,NEW_START:4,NEW_END:8},p={SURROUND:o.REF_START|o.REF_END,OVERLAP_START:o.REF_START|o.NEW_END,OVERLAP_END:o.REF_END|o.NEW_START,WITHIN:o.NEW_START|o.NEW_END},q=c.resolutionType={RESOLUTION_WITHIN:0,RESOLUTION_OVERLAP_START:1,RESOLUTION_OVERLAP_END:2,RESOLUTION_SURROUND:3},r=c.event={RESOLVED_OVERLAP:"overlap-resolver-resolved-overlap",RESOLVED_MERGE:"overlap-resolver-resolved-overlap"},s=function(){function a(b){e(this,a),this.eventManager=b}return k(a,[{key:"resolve",value:function(b,c){var d=void 0,e=void 0;a.isOverlapping(b,c)&&(d=b.project===c.project?r.RESOLVED_MERGE:r.RESOLVED_OVERLAP,e=b.project===c.project?i(b,c):j(b,c),this.eventManager.fire(d,e))}}],[{key:"isOverlapping",value:function(a,b){return g(a,b)>0}}]),a}();c.default=s},{"../lib/utils/Date":4,"./data/TimeSlice":13}],6:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){return Math.floor(a/config.tilesPerDay)}function f(a){var b=document.createElement("div"),c=function(b){b.line=a};return b.addEventListener("mousedown",c),b.addEventListener("mousemove",c),b.addEventListener("mouseup",c),b.setAttribute("data-timeline",a.user),b}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/Date"),i=function a(b,c){d(this,a),this.startDate=b,this.user=c},j=function(){function a(b,c){d(this,a),this.wrapper=b,this.startDate=c}return g(a,[{key:"addGroup",value:function(b){var c=document.createDocumentFragment(),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=new a(e,this.startDate);return d.setAttribute("class","group-wrapper"),e.setAttribute("class","line-wrapper"),f.appendChild(document.createTextNode(b)),d.appendChild(f),d.appendChild(e),c.appendChild(d),this.wrapper.appendChild(c),g}},{key:"addLine",value:function(a){var b=new i(this.startDate,a),c=f(b);b.wrapper=c,this.wrapper.appendChild(c)}},{key:"getDateFromTile",value:function(a){return new Date(this.startDate.getTime()+h.INTERVAL.ONEDAY*e(a)+h.INTERVAL.ONEHOUR*(config.startHour+a%config.tilesPerDay))}}]),a}();c.default=j},{"../lib/utils/Date":4}],7:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}var f,g,h=a("./OverlapResolver"),i=e(h),j=a("./TimeLine"),k=e(j),l=a("./TimeLineRenderer"),m=e(l),n=a("./TimeLineToolbox"),o=e(n),p=a("../lib/utils/Date"),q=d(p),r=a("./data/Project"),s=e(r),t=a("./data/TimeSlice"),u=e(t),v=a("../lib/MouseStateListener"),w=e(v),x=document.getElementById("timeline"),y=q.toMidnight(new Date),z=new i.default,A=new k.default(x,y),B=new m.default(x,y),C=new o.default(A,new w.default(document.querySelector("html"))),D=A.addGroup("it"),E=C.createTool("move"),F=C.createTool("create"),G=document.querySelectorAll("[data-tool=create]"),H=document.querySelectorAll("[data-tool=move]"),I=s.default.create("Play&Gold","#FC0"),J=(s.default.create("Antargaz","#0F0"),I),K=[];for(D.addLine("Julien"),D.addLine("Brieuc"),F.mousedown=function(a,b){if(void 0!==a){var c=A.getDateFromTile(b);g=u.default.create(J,a.user,c,c),B.addSlice(g,a)}},F.mousemove=function(a,b){var c=A.getDateFromTile(b);c>=g.startDate&&(g.endDate=c),B.refresh()},F.mouseup=function(a,b){var c=function(a){return a.user===g.user&&z.isOverlapping(a,g)},d=function(a){return a.project===g.project},e=K.filter(c),f=e.filter(d);e.length>0?(e.length===f.length&&(e.forEach(function(a){g.project===a.project&&(z.resolve(a,g),g.startDate=a.startDate,g.endDate=a.endDate)}),B.refresh()),B.removeSlice(g),g=null):(K.push(g),B.refresh())},f=0;f<G.length;f+=1)C.attachButton(F,G[f]);for(f=0;f<H.length;f+=1)C.attachButton(E,H[f])},{"../lib/MouseStateListener":2,"../lib/utils/Date":4,"./OverlapResolver":5,"./TimeLine":6,"./TimeLineRenderer":8,"./TimeLineToolbox":9,"./data/Project":10,"./data/TimeSlice":13}],8:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("../lib/utils/Date"),g=function(){function a(b,c){d(this,a),this.wrapper=b,this.refDate=c,this.slices=[]}return e(a,[{key:"addSlice",value:function(a,b){var c=document.createElement("div");c.appendChild(document.createTextNode(a.project.name)),c.setAttribute("class","time-slice"),c.style.top=b.wrapper.offsetTop+"px",this.wrapper.appendChild(c),this.slices.push({element:c,line:b,timeSlice:a}),this.refresh()}},{key:"removeSlice",value:function(a){var b=this.slices.findIndex(function(b){return b.timeSlice===a});b>=0&&(this.wrapper.removeChild(this.slices[b].element),this.slices.splice(b,1))}},{key:"refresh",value:function(){var a=this;this.slices.forEach(function(b){var c=(0,f.tileFromDate)(b.timeSlice.startDate,a.refDate,config.startHour,config.tilesPerDay),d=(0,f.tileFromDate)(b.timeSlice.endDate,a.refDate,config.startHour,config.tilesPerDay)+1,e=d-c,g={width:e*config.tileSize+"px",left:c*config.tileSize+"px",top:b.line.wrapper.offsetTop+"px",backgroundColor:b.timeSlice.project.color+"px"};Object.assign(b.element.style,g)})}}]),a}();c.default=g},{"../lib/utils/Date":4}],9:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){return Math.floor(a/config.tileSize)}function g(a,b,c){return{event:a,line:b,tile:f(c)}}function h(a,b){var c=i(b);c&&c[a.event]&&c[a.event](a.line,a.tile)}function i(a){return Object.values(a).find(function(a){return a.active})}function j(a){a.forEach(function(a){var b=a.tool.active?"addClass":"removeClass";m[b](a.button,"active")})}Object.defineProperty(c,"__esModule",{value:!0}),c.Tool=void 0;var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a("../lib/utils/CSS"),m=d(l),n=c.Tool=function a(b){e(this,a),this.mousedown=this.mousemove=this.mouseup=function(){},this.name=b,this.active=!1},o=function(){function a(b,c){var d=this;e(this,a),this.mouseListener=c,this.tools={},this.attachedButtons=[],b.wrapper.addEventListener("mousedown",function(a){h(g("mousedown",a.line,a.offsetX),d.tools)}),b.wrapper.addEventListener("mousemove",function(a){d.mouseListener.isDown&&void 0!==a.line&&h(g("mousemove",a.line,a.offsetX),d.tools)}),b.wrapper.addEventListener("mouseup",function(a){h(g("mouseup",a.line,a.offsetX),d.tools)})}return k(a,[{key:"createTool",value:function(a){return this.tools[a]=new n(a),this.tools[a]}},{key:"attachButton",value:function(a,b){var c=this;b.addEventListener("click",function(b){Object.values(c.tools).forEach(function(a){return a.active=!1}),void 0!==c.tools[a.name]&&(c.tools[a.name].active=!0),j(c.attachedButtons),b.preventDefault()}),this.attachedButtons.push({button:b,tool:a})}}]),a}();c.default=o},{"../lib/utils/CSS":3}],10:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function a(b,c){d(this,a),this.name=b,this.color=c},g=function(){function a(){d(this,a)}return e(a,null,[{key:"create",value:function(a,b){return new f(a,b)}}]),a}();c.default=g},{}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./TimeLineDataManager"),j=d(i),k=a("./Project"),l=d(k),m=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),h(b,[{key:"parseData",value:function(a){return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return l.default.create(a.name,a.color)})}}]),b}(j.default);c.default=m},{"./Project":10,"./TimeLineDataManager":12}],12:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){},g=function(){function a(b,c){d(this,a),this.eventManager=c,this.resourceServer=f[b]}return e(a,[{key:"findAll",value:function(){return this.findBy()}},{key:"find",value:function(a){return this.findBy({id:a})}},{key:"findBy",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){a.resourceServer(b).get(function(b,e){b?d(b):c(a.parseData(e))})})}},{key:"parseData",value:function(a){return a}}]),a}();c.default=g},{}],13:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function a(b,c,e,f){d(this,a),this.project=b,this.user=c,this.startDate=e,this.endDate=f},g=function(){function a(){d(this,a)}return e(a,null,[{key:"create",value:function(a,b,c,d){return new f(a,b,c,d)}}]),a}();c.default=g},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13]);