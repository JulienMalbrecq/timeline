// 2017-07-12

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.setEnabled(),this.setCallback(b),this.setWeight(c)}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"setCallback",value:function(a){if(!(a&&a.constructor&&a.call&&a.apply))throw"The callback argument is not a function.";this.callback=a}},{key:"setWeight",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.weight=parseInt(a,10)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];if(this.enabled)return b=Array.isArray(b)?b:[b],this.callback.apply(a,b)}}]),a}(),g=function(){function a(b){d(this,a),this.name=b,this.enabled=!0,this.callbacks=[],this.setEnabled()}return e(a,[{key:"setEnabled",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enabled=a}},{key:"addCallback",value:function(a){var b=new f(a);return this.callbacks.push(b),b}},{key:"removeCallback",value:function(a){var b=this.callbacks.findIndex(function(b){return b===a});b>-1&&this.callbacks.splice(b,1)}},{key:"fire",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,b=arguments[1];this.callbacks.sort(function(a,b){return a.weight<=b.weight?1:-1}),this.callbacks.forEach(function(c){return c.fire(a,b)})}}]),a}(),h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(d(this,a),this.private=!1,this.events={},Object.assign(this,b),!1===this.private)return void 0===a.instance&&(a.instance=this),a.instance}return e(a,[{key:"bind",value:function(a,b){var c=this;if(Array.isArray(a)){var d={};return a.forEach(function(a){return d[a]=c.bind(a,b)}),d}return!1===this.hasEvent(a)&&(this.events[a]=new g(a)),this.events[a].addCallback(b)}},{key:"detachEvent",value:function(a){var b=this.events[a];return this.removeEvent(a),b}},{key:"hasEvent",value:function(a){return void 0!==this.events[a]}},{key:"getEvent",value:function(a){if(!1===this.hasEvent(a))throw"Unknown event "+a;return this.events[a]}},{key:"fireEvent",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;if(a instanceof g==!1){if(!this.hasEvent(a))return this;a=this.getEvent(a)}a instanceof g&&a.fire(c,b)}},{key:"fireEventAsync",value:function(a,b,c){var d=this;setTimeout(function(){return d.fireEvent(a,b,c)},1)}},{key:"fireEventOnce",value:function(a,b,c){this.fireEvent(this.detachEvent(a),b,c)}},{key:"fireEventOnceAsync",value:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;setTimeout(function(){return c.fireEventOnce(a,b,d)},1)}},{key:"disableEvent",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getEvent(a).enabled=b}},{key:"removeEvent",value:function(a){delete this.events[a]}}]),a}();c.default=h},{}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=this;d(this,a),this._isDown=!1,this.wrapper=b,b.addEventListener("mousedown",function(a){return c._isDown=!0}),b.addEventListener("mouseup",function(a){return c._isDown=!1})}return e(a,[{key:"isDown",get:function(){return this._isDown}}]),a}();c.default=f},{}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=function(a,b,c){Array.isArray(a)||(a=[a]);var d=void 0,f=a.length;for(d=0;d<f;d+=1)e(a[d],b,c)},e=c.manipulateClassNames=function(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=(a.className||"").trim().split(" ").filter(function(a){return a!==b});c&&d.push(b),a.className=d.join(" ").trim()},f=(c.addClass=function(a,b){d(a,b,!0)},c.removeClass=function(a,b){d(a,b,!1)},c.toggleClass=function(a,b){d(a,b,f(a,b))},c.hasClass=function(a,b){return(a.className||"").trim().split(" ").filter(function(a){return a===b}).length>0})},{}],4:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=(c.INTERVAL={ONEMINUTE:6e4,ONEHOUR:36e5,ONEDAY:864e5},c.dateDiff=function(a,b,c){return Math.floor((a-b)/c)},c.setHour=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return a.setHours(b),a.setMinutes(c),a.setSeconds(d),a.setMilliseconds(e),a});c.toMidnight=function(a){return d(a,0)}},{}],5:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getTileLengthFromDuration=c.getDateFromTile=c.getDaysFromTile=c.getTileFromDate=c.getTileFromOffset=void 0;var d=a("./Date.es6"),e=(c.getTileFromOffset=function(a){return Math.floor(a/config.tileSize)},c.getTileFromDate=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:config.startDate,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:config.startHour,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:config.tilesPerDay,f=(0,d.setHour)(new Date(a),c);return(0,d.dateDiff)(a,b,d.INTERVAL.ONEDAY)*e+(0,d.dateDiff)(a,f,d.INTERVAL.ONEHOUR)},c.getDaysFromTile=function(a){return Math.floor(a/config.tilesPerDay)});c.getDateFromTile=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:config.startDate;return new Date(b.getTime()+d.INTERVAL.ONEDAY*e(a)+d.INTERVAL.ONEHOUR*(config.startHour+a%config.tilesPerDay))},c.getTileLengthFromDuration=function(a){return Math.ceil(a/d.INTERVAL.ONEHOUR)}},{"./Date.es6":4}],6:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){return b>=a.startDate&&b<=a.endDate}function g(a,b){var c=0;return f(b,a.startDate)&&(c|=o.REF_START),f(b,a.endDate)&&(c|=o.REF_END),f(a,b.startDate)&&(c|=o.NEW_START),f(a,b.endDate)&&(c|=o.NEW_END),c}function h(a,b){return(a&b)===b}function i(a,b){var c=g(a,b),d=[a,b];return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate=b.startDate,d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate=b.endDate,d.push(q.RESOLUTION_OVERLAP_END)):h(c,p.SURROUND)?(a.startDate=b.startDate,a.endDate=b.endDate,d.push(q.RESOLUTION_SURROUND)):d=null,d}function j(a,b){var c=g(a,b),d=[a,b],e=void 0;return h(c,p.WITHIN)?d.push(q.RESOLUTION_WITHIN):h(c,p.OVERLAP_START)?(a.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_START)):h(c,p.OVERLAP_END)?(a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_OVERLAP_END)):(e=n.factory.create(a.project,a.startDate,a.endDate),e.startDate.setTime(b.endDate.getTime()+l.INTERVAL.ONEHOUR),a.endDate.setTime(b.startDate.getTime()-l.INTERVAL.ONEHOUR),d.push(q.RESOLUTION_SURROUND),d.push(e)),e}Object.defineProperty(c,"__esModule",{value:!0}),c.event=c.resolutionType=void 0;var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a("../lib/utils/Date.es6"),m=a("./data/TimeSlice.es6"),n=d(m),o={REF_START:1,REF_END:2,NEW_START:4,NEW_END:8},p={SURROUND:o.REF_START|o.REF_END,OVERLAP_START:o.REF_START|o.NEW_END,OVERLAP_END:o.REF_END|o.NEW_START,WITHIN:o.NEW_START|o.NEW_END},q=c.resolutionType={RESOLUTION_WITHIN:0,RESOLUTION_OVERLAP_START:1,RESOLUTION_OVERLAP_END:2,RESOLUTION_SURROUND:3},r=c.event={RESOLVED_OVERLAP:"overlap-resolver-resolved-overlap",RESOLVED_MERGE:"overlap-resolver-resolved-overlap"},s=function(){function a(b){e(this,a),this.eventManager=b}return k(a,[{key:"isOverlapping",value:function(a,b){return g(a,b)>0}},{key:"resolve",value:function(a,b){var c=void 0,d=void 0,e=null;return this.isOverlapping(a,b)&&(c=a.project===b.project?r.RESOLVED_MERGE:r.RESOLVED_OVERLAP,d=a.project===b.project?i(a,b):j(a,b),e={type:c,resolution:d}),e}}]),a}();c.default=s},{"../lib/utils/Date.es6":4,"./data/TimeSlice.es6":16}],7:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){var b=document.createElement("div"),c=function(b){b.line=a};return b.addEventListener("mousedown",c),b.addEventListener("mousemove",c),b.addEventListener("mouseup",c),b.setAttribute("data-timeline",a.user),b}Object.defineProperty(c,"__esModule",{value:!0}),c.events=void 0;var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/Tile.es6"),i=d(h),j=function a(b,c){e(this,a),this.startDate=b,this.user=c},k=c.events={SLICE_ADDED:"timeline-slice-added",SLICE_REMOVED:"timeline-slice-removed"},l=function(){function a(b,c,d){e(this,a),this.eventsManager=d,this.wrapper=b,this.startDate=c,this.slices=[]}return g(a,[{key:"addGroup",value:function(b){var c=document.createDocumentFragment(),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("div"),g=new a(e,this.startDate);return d.setAttribute("class","group-wrapper"),e.setAttribute("class","line-wrapper"),f.appendChild(document.createTextNode(b)),d.appendChild(f),d.appendChild(e),c.appendChild(d),this.wrapper.appendChild(c),g}},{key:"addLine",value:function(a){var b=new j(this.startDate,a),c=f(b);b.wrapper=c,this.wrapper.appendChild(c)}},{key:"addSlice",value:function(a){void 0===this.slices.find(function(b){return b===a})&&(this.eventsManager.fireEvent(k.SLICE_ADDED,a),this.slices.push(a))}},{key:"removeSlice",value:function(a){var b=this.slices.findIndex(function(b){return b===a});b>=0&&(this.slices.splice(b,1),this.eventsManager.fireEvent(k.SLICE_REMOVED,a))}},{key:"getSlice",value:function(a,b){var c=i.getDateFromTile(b);return this.slices.find(function(b){return b.line===a&&b.containsDate(c)})}}]),a}();c.default=l},{"../lib/utils/Tile.es6":5}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/Date.es6"),i=e(h),j=a("./TimeLineContainer.es6"),k=d(j),l=a("./data/TimeSlice.es6"),m=e(l),n=a("./data/TimeLineDataManager.es6"),o=a("./OverlapResolver.es6"),p=a("./TimeLine.es6"),q=e(p),r=function(){function a(b,c){f(this,a),this.container=new k.default({wrapper:b,refDate:c}),this.wrapper=b,this.refDate=c,this.eventManager=this.container.get("eventsManager"),this.overlapResolver=this.container.get("overlapResolver"),this.timeLine=this.container.get("timeLine"),this.renderer=this.container.get("renderer"),this.toolBox=this.container.get("toolbox"),this.init(),this.tempInit()}return g(a,[{key:"init",value:function(){var a=this;this.toolBox.initInterface(),this.eventManager.bind(q.events.SLICE_ADDED,function(b){a.renderer.initSlice(b)}),this.eventManager.bind(q.events.SLICE_REMOVED,function(b){void 0!==b.element&&a.renderer.wrapper.removeChild(b.element)}),this.eventManager.bind(m.events.POST_CREATE,function(b){b&&a.timeLine.addSlice(b)}),this.eventManager.bind(m.events.CHANGED,function(b){b&&b.changed&&a.renderer.render(a.timeLine.slices)}),this.eventManager.bind(n.events.POST_REMOVE,function(b){b&&a.timeLine.removeSlice(b)}),this.eventManager.bind(n.events.PRE_PERSIST,function(b){var c=b.resource,d=void 0,e=[],f=a.container.get("dataManager").getDataManager("timeslice"),g=a.timeLine.slices.filter(function(b){return b!==c&&b.line===c.line&&a.overlapResolver.isOverlapping(b,c)}),h=g.filter(function(a){return c.project===a.project});g.length>0&&(g.length===h.length?g.forEach(function(g){if(null!==(d=a.overlapResolver.resolve(g,c))){if(a.timeLine.removeSlice(c),e.push(g),!1===c.isTemp){var h=e.findIndex(function(a){return a===c});h>=0&&e.splice(h,1),f.remove(c)}d.type!==o.resolutionType.RESOLUTION_WITHIN&&(c=g,b.shouldPersist=!1)}}):b.shouldPersist=!1),e.forEach(function(a){return f.update(a)}),a.renderer.render(a.timeLine.slices)})}},{key:"tempInit",value:function(){var a=this.timeLine.addGroup("it");a.addLine("Julien"),a.addLine("Brieuc")}}]),a}();config.startDate=i.toMidnight(config.startDate);new r(document.getElementById("timeline"),config.startDate)},{"../lib/utils/Date.es6":4,"./OverlapResolver.es6":6,"./TimeLine.es6":7,"./TimeLineContainer.es6":9,"./data/TimeLineDataManager.es6":15,"./data/TimeSlice.es6":16}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../lib/EventsManager.es6"),h=d(g),i=a("./OverlapResolver.es6"),j=d(i),k=a("./TimeLine.es6"),l=d(k),m=a("./TimeLineRenderer.es6"),n=d(m),o=a("../lib/MouseStateListener.es6"),p=d(o),q=a("./data/TimeLineDataManager.es6"),r=d(q),s=a("./data/ProjectDataManager.es6"),t=d(s),u=a("./data/TimeSliceDataManager.es6"),v=d(u),w=a("./data/TimeSlice.es6"),x=a("./TimeLineToolbox.es6"),y=d(x),z=a("./tool/CreateTool.es6"),A=d(z),B=a("./tool/MoveTool.es6"),C=d(B),D=a("./tool/DeleteTool.es6"),E=d(D),F=function(){function a(b){e(this,a),this._services={},this._options=b,this.init()}return f(a,[{key:"init",value:function(){var a=this;this._services.eventsManager=new h.default({private:!0}),this._services.mouseListener=new p.default(document.querySelector("html")),this._services.dataManager=new r.default,this._services.dataManager.addDataManager(new t.default(this._services.eventsManager)),this._services.dataManager.addDataManager(new v.default(this._services.eventsManager)),this._services.overlapResolver=new j.default(this._services.eventsManager),this._services.timeLine=new l.default(this._options.wrapper,this._options.refDate,this._services.eventsManager),this._services.renderer=new n.default(this._options.wrapper,this._options.refDate),this._services.timeSliceFactory=new w.TimeSliceFactory(this._services.eventsManager),this._services.toolbox=new y.default(this._services.timeLine,this._services.mouseListener),this._services.tools={create:new A.default(this._services.timeLine,this._services.timeSliceFactory,this._services.dataManager.getDataManager("timeslice"),this._services.dataManager.getDataManager("project")),delete:new E.default(this._services.timeLine,this._services.dataManager.getDataManager("timeslice")),move:new C.default(this._services.timeLine,this._services.dataManager.getDataManager("timeslice"))},Object.keys(this._services.tools).forEach(function(b){return a._services.toolbox.addTool(a._services.tools[b])})}},{key:"get",value:function(a){if(!1==a in this._services)throw"Undefined service "+a;return this._services[a]}}]),a}();c.default=F},{"../lib/EventsManager.es6":1,"../lib/MouseStateListener.es6":2,"./OverlapResolver.es6":6,"./TimeLine.es6":7,"./TimeLineRenderer.es6":10,"./TimeLineToolbox.es6":11,"./data/ProjectDataManager.es6":14,"./data/TimeLineDataManager.es6":15,"./data/TimeSlice.es6":16,"./data/TimeSliceDataManager.es6":17,"./tool/CreateTool.es6":18,"./tool/DeleteTool.es6":19,"./tool/MoveTool.es6":20}],10:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("../lib/utils/Tile.es6"),g=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;d(this,a),this.wrapper=b,this.refDate=c}return e(a,[{key:"render",value:function(a){var b=this;a.forEach(function(a){if(!1!==a.changed){void 0===a.element&&b.initSlice(a);var c=(0,f.getTileFromDate)(a.startDate),d=(0,f.getTileFromDate)(a.endDate)+1,e=d-c,g={width:e*config.tileSize+"px",left:c*config.tileSize+"px",top:a.line.wrapper.offsetTop+"px",backgroundColor:""+a.project.color};Object.assign(a.element.style,g),a.changed=!1}})}},{key:"initSlice",value:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a.project.name)),b.setAttribute("class","time-slice"),b.style.top=a.line.wrapper.offsetTop+"px",this.wrapper.appendChild(b),a.element=b}}]),a}();c.default=g},{"../lib/utils/Tile.es6":5}],11:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../lib/utils/CSS.es6"),i=d(h),j=a("../lib/utils/Tile.es6"),k=d(j),l=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(this,a),this.timeLine=b,this.mouseListener=c,this.tools=[],this.attachedButtons=[],this.initListeners()}return g(a,[{key:"initListeners",value:function(){var a=this;this.timeLine&&this.mouseListener&&(this._toolDependencies={timeLine:this.timeLine,mouseListener:this.mouseListener},this.timeLine.wrapper.addEventListener("mousedown",function(b){void 0!==b.line&&a.handleMouseEvent("mouseDown",b.line,b.offsetX)}),this.timeLine.wrapper.addEventListener("mousemove",function(b){a.mouseListener.isDown&&void 0!==b.line&&a.handleMouseEvent("mouseMove",b.line,b.offsetX)}),this.mouseListener.wrapper.addEventListener("mouseup",function(b){a.handleMouseEvent("mouseUp",b.line||null,b.offsetX)}),this.tools.forEach(function(b){return Object.assign(b,a._toolDependencies)}))}},{key:"initInterface",value:function(){var a=this;this.tools.forEach(function(b){[].concat(e(document.querySelectorAll('[data-tool="'+b.name+'"]'))).forEach(function(c){return a.attachButton(c,b)}),b.initInterface()})}},{key:"addTool",value:function(a){Object.assign(a,this._toolDependencies),this.tools.push(a)}},{key:"getToolByName",value:function(a){return this.tools.find(function(b){return b.name===a})}},{key:"attachButton",value:function(a,b){var c=this;a.addEventListener("click",function(a){a.preventDefault(),c.tools.forEach(function(a){return a.active=a===b}),c.redraw()}),this.attachedButtons.push({button:a,tool:b})}},{key:"handleMouseEvent",value:function(a,b,c){var d=k.getTileFromOffset(c),e=this.tools.find(function(a){return a.active});e&&e[a]&&e[a](b,d)}},{key:"redraw",value:function(){this.attachedButtons.forEach(function(a){var b=a.tool.active?"addClass":"removeClass";i[b](a.button,"active")})}}]),a}();c.default=l},{"../lib/utils/CSS.es6":3,"../lib/utils/Tile.es6":5}],12:[function(a,b,c){(function(b){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./TimeLineDataManager.es6"),h="undefined"!=typeof window?window.fermata:void 0!==b?b.fermata:null,i=d(h),j=i.default.json(config.resourceServer),k=function(){function a(b,c){e(this,a),this.resourceName=b,this.resourceServer=j[b],this.eventsManager=c}return f(a,[{key:"findAll",value:function(){return this.findBy()}},{key:"find",value:function(a){return this.findBy({id:a})}},{key:"findBy",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(c,d){a.resourceServer(b).get(function(b,e){b?d(b):c(a.parseData(e))})})}},{key:"update",value:function(a){var b={resource:a,shouldUpdate:!0};return this.eventsManager.fireEvent(g.events.PRE_UPDATE,b),b.shouldUpdate?(console.log("updating",a),this.eventsManager.fireEvent(g.events.POST_UPDATE,a)):console.log("should not update",a),b.shouldUpdate}},{key:"persist",value:function(a){var b={resource:a,shouldPersist:!0};return this.eventsManager.fireEvent(g.events.PRE_PERSIST,b),b.shouldPersist?(a.isTemp=!1,console.log("persisting",a),this.eventsManager.fireEvent(g.events.POST_PERSIST,a),!0):(console.log("should not persist",a),!1)}},{key:"remove",value:function(a){this.eventsManager.fireEvent(g.events.PRE_REMOVE,a),console.log("removing",a),this.eventsManager.fireEvent(g.events.POST_REMOVE,a)}},{key:"parseData",value:function(a){return a}}]),a}();c.default=k}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./TimeLineDataManager.es6":15}],13:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function a(b,c){d(this,a),this.name=b,this.color=c},g=function(){function a(){d(this,a)}return e(a,null,[{key:"create",value:function(a,b){return new f(a,b)}}]),a}();c.default=g},{}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./AbstractDataManager.es6"),j=d(i),k=a("./Project.es6"),l=d(k),m=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"project"))}return g(b,a),h(b,[{key:"findAll",value:function(){var a=this;return new Promise(function(b,c){b(a.parseData([{name:"Play&Gold",color:"#FFCC00"},{name:"Antargaz",color:"#00FF00"}]))})}},{key:"parseData",value:function(a){return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return l.default.create(a.name,a.color)})}}]),b}(j.default);c.default=m},{"./AbstractDataManager.es6":12,"./Project.es6":13}],15:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this.dataManagers=[]}return e(a,[{key:"addDataManager",value:function(a){this.dataManagers.push(a)}},{key:"getDataManager",value:function(a){return this.dataManagers.find(function(b){return b.resourceName===a})}}]),a}();c.default=f;c.events={PRE_PERSIST:"data-manager-pre-persist",POST_PERSIST:"data-manager-post-persist",PRE_REMOVE:"data-manager-pre-remove",POST_REMOVE:"data-manager-post-remove",PRE_UPDATE:"data-manager-pre-update",POST_UPDATE:"data-manager-post-update"}},{}],16:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c.TimeSlice=function(){function a(b,c,e,f){var g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];d(this,a),this._project=b,this._line=c,this._startDate=e,this._endDate=f,this._isTemp=g,this._changed=h,this._id=null,this.eventsManager=null}return e(a,[{key:"containsDate",value:function(a){return this._startDate<=a&&this._endDate>=a}},{key:"duration",get:function(){return this._endDate-this._startDate}},{key:"id",get:function(){return this._id},set:function(a){this._id=a}},{key:"project",get:function(){return this._project},set:function(a){this._project=a,this.changed=!0}},{key:"line",get:function(){return this._line},set:function(a){this._line=a,this.changed=!0}},{key:"startDate",get:function(){return this._startDate},set:function(a){this._startDate=a,this.changed=!0}},{key:"endDate",get:function(){return this._endDate},set:function(a){this._endDate=a,this.changed=!0}},{key:"isTemp",get:function(){return this._isTemp},set:function(a){this._isTemp=a,this.changed=!0}},{key:"changed",get:function(){return this._changed},set:function(a){this._changed=a,this.eventsManager&&this.eventsManager.fireEvent(g.CHANGED,this)}}]),a}(),g=(c.TimeSliceFactory=function(){function a(b){d(this,a),this.eventsManager=b}return e(a,[{key:"create",value:function(a,b,c,d){if(this.eventsManager){var e={project:a,line:b,startDate:c,endDate:d};this.eventsManager.fireEvent(g.PRE_CREATE,e);var a=e.project,b=e.line,c=e.startDate,d=e.endDate}for(var h=arguments.length,i=Array(h>4?h-4:0),j=4;j<h;j++)i[j-4]=arguments[j];var k=new(Function.prototype.bind.apply(f,[null].concat([a,b,c,d],i)));if(k.eventsManager=this.eventsManager,this.eventsManager){var l=k;this.eventsManager.fireEvent(g.POST_CREATE,l),k=l}return k}}]),a}(),c.events={CHANGED:"timeslice-changed",PRE_CREATE:"timeslice-pre-create-event",POST_CREATE:"timeslice-post-create-event"})},{}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./AbstractDataManager.es6"),j=d(i),k=a("./TimeSlice.es6"),l=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"timeslice",a))}return g(b,a),h(b,[{key:"parseData",value:function(a){return!1===Array.isArray(a)&&(a=[a]),a.map(function(a){return k.factory.create(a.project,null,a.startDate,a.endDate,!1,!1)})}}]),b}(j.default);c.default=l},{"./AbstractDataManager.es6":12,"./TimeSlice.es6":16}],18:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=a("./TimeLineTool.es6"),l=e(k),m=a("../../lib/utils/Tile.es6"),n=d(m),o=function(a){function b(a,c,d,e){g(this,b);var f=h(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"create",a));return f.timeSliceManager=d,f.projectManager=e,f.timeSliceFactory=c,f.lastSlice=null,f._currentProject=null,f.projectList=[],f}return i(b,a),j(b,[{key:"initInterface",value:function(){var a=this;this.projectManager.findAll().then(function(b){var c=document.querySelectorAll('[data-tool-create="selector"]'),d=document.createDocumentFragment();a.projectList=b,a.projectList.length>0&&(a.currentProject=a.projectList[0].name),b.forEach(function(a){var b=document.createElement("option"),c=document.createTextNode(a.name);b.appendChild(c),b.setAttribute("value",a.name),d.appendChild(b)}),[].concat(f(c)).forEach(function(b){b.appendChild(d),b.addEventListener("change",function(b){return a.currentProject=b.target.value})})})}},{key:"mouseDown",value:function(a,b){if(null!==a){var c=n.getDateFromTile(b);this.lastSlice=this.timeSliceFactory.create(this.currentProject,a,c,c)}}},{key:"mouseMove",value:function(a,b){var c=n.getDateFromTile(b);this.lastSlice&&c>=this.lastSlice.startDate&&(this.lastSlice.endDate=c)}},{key:"mouseUp",value:function(a,b){a&&!1===this.timeSliceManager.persist(this.lastSlice)&&this.timeLine.removeSlice(this.lastSlice),this.lastSlice=null,console.log(this.timeLine.slices)}},{key:"currentProject",get:function(){return this._currentProject},set:function(a){this._currentProject=this.projectList.find(function(b){return b.name===a})}}]),b}(l.default);c.default=o},{"../../lib/utils/Tile.es6":5,"./TimeLineTool.es6":21}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./TimeLineTool.es6"),j=d(i),k=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"delete",a));return d.timeSliceManager=c,d.selectedSlice=null,d}return g(b,a),h(b,[{key:"mouseDown",value:function(a,b){this.selectedSlice=this.timeLine.getSlice(a,b)}},{key:"mouseUp",value:function(a,b){if(this.selectedSlice){var c=this.timeLine.getSlice(a,b);this.selectedSlice===c&&this.timeSliceManager.remove(this.selectedSlice)}this.selectedSlice=null}}]),b}(j.default);c.default=k},{"./TimeLineTool.es6":21}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./TimeLineTool.es6"),j=d(i),k=a("../../lib/utils/Tile.es6"),l=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"move",a));return d.timeSliceManager=c,d.origin=null,d.selectedSlice=null,d}return g(b,a),h(b,[{key:"mouseDown",value:function(a,b){this.selectedSlice=this.timeLine.getSlice(a,b),this.selectedSlice&&(this.origin={line:a,tile:b,startTile:(0,k.getTileFromDate)(this.selectedSlice.startDate),endTile:(0,k.getTileFromDate)(this.selectedSlice.endDate)})}},{key:"mouseMove",value:function(a,b){this.selectedSlice&&this.computeNewPosition(b)}},{key:"mouseUp",value:function(a,b){if(this.selectedSlice){!1===this.timeSliceManager.persist(this.selectedSlice)&&this.computeNewPosition(this.origin.tile)}this.origin=null,this.selectedSlice=null}},{key:"computeNewPosition",value:function(a){var b=a-this.origin.tile;this.selectedSlice.startDate=(0,k.getDateFromTile)(this.origin.startTile+b),this.selectedSlice.endDate=(0,k.getDateFromTile)(this.origin.endTile+b)}}]),b}(j.default);c.default=l},{"../../lib/utils/Tile.es6":5,"./TimeLineTool.es6":21}],21:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d(this,a),this.name=b,this.active=!1,this.timeLine=c,this.mouseListener=e}return e(a,[{key:"initInterface",value:function(){}},{key:"mouseDown",value:function(a,b){}},{key:"mouseMove",value:function(a,b){}},{key:"mouseUp",value:function(a,b){}}]),a}();c.default=f},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]);
//# sourceMappingURL=app.min.js.map