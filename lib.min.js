// 2017-07-14

var Proxy=function(){if("Proxy"in this)return this.Proxy}(),fermata={plugins:{}};if(fermata.registerPlugin=function(a,b){fermata.plugins[a]=b,fermata[a]=function(){var b={base:"",path:[""],query:{}},c=[a].concat([].slice.call(arguments)),d=fermata._makeTransport.call(b,"_base").using.apply(null,c);return fermata._makeNativeURL(d,b)},fermata._useExports&&(exports[a]=fermata[a])},fermata._makeTransport=function(a,b){var c=this,d=fermata.plugins[a].apply(c,b);return d.using=function(){var a=arguments[0];return arguments[0]=d,fermata._makeTransport.call(c,a,arguments)},d},fermata._makeNativeURL=function(a,b){return fermata._wrapTheWrapper(function(){var c=[].slice.call(arguments),d=fermata._typeof2(c[c.length-1]);if("undefined"===d)return fermata._stringForURL(b);if("function"===d){var e=c.pop(),f=c.pop(),g=fermata._normalize(c.pop()||{}),h=c.pop()||{},i=b.path.pop().toUpperCase();return"DEL"===i&&(i="DELETE"),"string"==typeof h&&(console&&console.warn&&console.warn("Using deprecated API: use an options object to set `{responseType:'"+h+"'}` instead of passing raw string."),h={responseType:h}),a({base:b.base,method:i,path:b.path,query:b.query,options:h,headers:g,data:f},e)}var j="object"===d?fermata._extend({},b.query,c.pop()):b.query,k=c.length?b.path.concat(c):b.path;return fermata._makeNativeURL(a,{base:b.base,path:k,query:j})})},fermata._wrapTheWrapper=function(a){return fermata._nodeProxy?fermata._nodeProxy.createFunction({getOwnPropertyDescriptor:function(a){},enumerate:function(){return[]},delete:function(){return!1},fix:function(){},set:function(a,b,c){},get:function(b,c){return a(c)}},a):Proxy&&Proxy.createFunction?Proxy.createFunction({getOwnPropertyDescriptor:function(a){},getPropertyDescriptor:function(a){},getPropertyNames:function(){return[]},enumerate:function(){return[]},defineProperty:function(){return!1},delete:function(){return!1},fix:function(){},get:function(b,c){return a(c)}},a):Proxy?new Proxy(a,{get:function(b,c){return a(c)}}):fermata._extend(a,{get:function(){return a("get").apply(null,arguments)},put:function(){return a("put").apply(null,arguments)},post:function(){return a("post").apply(null,arguments)},delete:function(){return a("delete").apply(null,arguments)},del:function(){return a("del").apply(null,arguments)}})},fermata._nodeTransport=function(a,b){var c=fermata._stringForURL(a),d=require("url").parse(c),e={};a.options.responseType||(a.options.responseType="text"),d.auth&&("either/or"!==require("url").parse("http//either%2for@example").auth&&(d.auth=decodeURIComponent(d.auth)),e.Authorization="Basic "+new Buffer(d.auth).toString("base64")),fermata._extend(e,a.headers),a.data&&"GET"===a.method||"HEAD"===a.method?(console&&console.warn&&console.warn("Ignoring data passed to GET or HEAD request."),a.data=null):"string"==typeof a.data&&(a.data=new Buffer(a.data,"utf8"),e["Content-Type"]||(e["Content-Type"]="text/plain;charset=UTF-8"));var f="https:"===d.protocol?require("https"):require("http"),g=fermata._extend({},a.options.node,{host:d.hostname,port:d.port,method:a.method,path:d.pathname+(d.search||""),headers:e,agent:a.options.node&&a.options.node.agent||f.globalAgent}),h=f.request(g);return fermata._isStream(a.data)?a.data.pipe(h):a.data?(h.setHeader("Content-Length",a.data.length),h.end(a.data)):(h.setHeader("Content-Length",0),h.end()),h.on("error",function(a){b(a,null)}),"stream"===a.options.responseType?h.on("response",function(a){b(null,{status:a.statusCode,headers:fermata._normalize(a.headers),data:a})}):h.on("response",function(c){function d(d){var g=Buffer.concat(e,f);"text"===a.options.responseType&&(g=g.toString("utf8")),b(d||null,{status:c.statusCode,headers:fermata._normalize(c.headers),data:g})}var e=[],f=0;c.on("data",function(a){e.push(a),f+=a.length}),c.on("end",d),c.on("close",function(){d(new Error("Connection dropped."))})}),h},fermata._xhrTransport=function(a,b){var c=new XMLHttpRequest,d=fermata._stringForURL(a),e=a.options.xhr||{};return c.open(a.method,d,!0),c.responseType=a.options.responseType||"text",Object.keys(e).forEach(function(a){c[a]=e[a]}),Object.keys(a.headers).forEach(function(b){c.setRequestHeader(b,a.headers[b])}),c.send(a.data),c.onreadystatechange=function(){if(this.readyState===(c.DONE||4))if(this.status){var a={};this.getAllResponseHeaders().split("\r\n").forEach(function(b){b&&(b=b.split(": "),a[b[0]]=b.slice(1).join(": "))}),b(null,{status:this.status,headers:fermata._normalize(a),data:this.response||this.responseText})}else b(Error("XHR request failed"),null)},c},fermata._stringForURL=function(a){var b=a.path.map(function(a){return a.join?a.join("/"):encodeURIComponent(a)}).join("/"),c=fermata._flatten(a.query).map(function(a){return encodeURIComponent(a[0])+(null!==a[1]?"="+encodeURIComponent(a[1]):"")}).join("&");return a.base+b+(c?"?"+c:"")},fermata._flatten=function(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c];"$"===c[0]&&(c=c.slice(1),"$"!==c[0]&&(d=JSON.stringify(d))),[].concat(d).forEach(function(a){b.push([c,a])})}),b},fermata._unflatten=function(a){var b={};return a.forEach(function(a){var c=a[0],d=a[1];b[c]={}.hasOwnProperty.call(b,c)?[].concat(b[c],d):d}),b},fermata._normalize=function(a){var b={};return Object.keys(a).forEach(function(c){var d=c.split("-").map(function(a){return a&&a[0].toUpperCase()+a.slice(1).toLowerCase()}).join("-");b[d]=a[c]}),b},fermata._extend=Object.assign?Object.assign:function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){b&&Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},fermata._typeof2=function(a){return Array.isArray(a)?"array":typeof a},"undefined"!=typeof exports&&(fermata._useExports=!0,exports.registerPlugin=fermata.registerPlugin,exports.plugins=fermata.plugins,!Proxy))try{fermata._nodeProxy=require("node-proxy")}catch(a){}"undefined"==typeof window&&fermata.registerPlugin("oauth",require("./plugins/oauth").init(fermata)),"object"==typeof process&&"object"==typeof process.versions&&"http_parser"in process.versions?fermata._transport=fermata._nodeTransport:fermata._transport=fermata._xhrTransport,fermata.registerPlugin("_base",function(){return function(a,b){return fermata._transport(a,b)}}),fermata.registerPlugin("raw",function(a,b){return fermata._extend(this,b),a}),fermata.registerPlugin("statusCheck",function(a){return function(b,c){return a(b,function(a,b){a||"2"===b.status.toFixed(0)[0]||(a=Error("Bad status code from server: "+b.status),a.status=b.status),c(a,b)})}}),fermata._nodeMultipartEncode=function(a){function b(a){var b=e,c=a instanceof Buffer?a:new Buffer(""+a);e=new Buffer(b.length+c.length+2),b.copy(e),c.copy(e,b.length),e.write("\r\n",e.length-2)}function c(a){return'"'+a.replace(/"|"/g,"%22").replace(/\r\n|\r|\n/g," ")+'"'}var d=""+Math.round(1e16*Math.random())+Math.round(1e16*Math.random());this.headers["Content-Type"]&&(this.headers["Content-Type"]+="; boundary="+d);var e=new Buffer(0);return fermata._flatten(a).forEach(function(a){if(b("--"+d),{}.hasOwnProperty.call(a[1],"data")){var e=a[1];b("Content-Disposition: form-data; name="+c(a[0])+"; filename="+c(e.name||"blob")),b("Content-Type: "+(e.type||"application/octet-stream")),b(""),b(e.data)}else b("Content-Disposition: form-data; name="+c(a[0])),b(""),b(a[1])}),b("--"+d+"--"),e},fermata._xhrMultipartEncode=function(a){var b=new FormData;return fermata._flatten(a).forEach(function(a){b.append(a[0],a[1])}),b},fermata._isStream=function(a){return fermata._transport===fermata._nodeTransport&&a instanceof require("stream").Readable},fermata.registerPlugin("autoConvert",function(a,b){var c={"text/plain":[function(a){return""+a},function(a){return""+a}],"application/json":[JSON.stringify,JSON.parse],"application/x-www-form-urlencoded":[function(a){return fermata._flatten(a).map(function(a){return encodeURIComponent(a[0]).replace(/%20/g,"+")+"="+encodeURIComponent(a[1]).replace(/%20/g,"+")}).join("&")},function(a){return fermata._unflatten(a.toString().split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a.replace(/\+/g," "))})}))}],"multipart/form-data":[fermata._transport===fermata._xhrTransport?fermata._xhrMultipartEncode:fermata._nodeMultipartEncode,null]};return function(d,e){b&&("GET"!==d.method&&"HEAD"!==d.method&&(d.headers["Content-Type"]||(d.headers["Content-Type"]=b)),d.headers.Accept||(d.headers.Accept=b));var f=d.headers["Content-Type"],g=(c[f]||[])[0];return g&&!fermata._isStream(d.data)&&(d.data=d.data&&g.call(d,d.data)),a(d,function(a,b){var f=d.headers.Accept,g=b&&b.headers["Content-Type"],h=(c[f]||c[g]||[])[1],i=b&&b.data,j=b&&fermata._extend({"X-Status-Code":b.status},b.headers);if(b&&204===b.status)i=null;else if("stream"===d.options.responseType);else if(h)try{i=h.call(b,i)}catch(b){a||(a=b)}e(a,i,j)})}}),fermata.registerPlugin("json",function(a,b){return this.base=b,a.using("statusCheck").using("autoConvert","application/json")}),fermata.registerPlugin("api",function(a,b){var c=b.url.replace(/\/$/,"");return b.user&&(c=c.replace(/\/\/(\w)/,"//"+b.user+":PASSWORD@$1")),console&&console.warn&&console.warn('Using deprecated API: please initialize with `fermata.json("'+c+'")` instead. This plugin will be disabled soon!'),this.base=c,a.using("statusCheck").using("autoConvert","application/json")});
//# sourceMappingURL=lib.min.js.map